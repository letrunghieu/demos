---
layout: d3
title: Line chart with an invisible layer to detect focused data point
excerpt: I used D3JS implementation of Voronoid tessellation to create an invisible layer of polygon
---
<div id="chart"></div>
<div id="focused-data-point"></div>
{% include dataviz/tooltips-line-chart-time-series-data/main-script.html %}

<script>
    function drawLineChart(dom, data, configs) {
        var svg = d3.select(dom)
                .append('svg')
                .attr('class', 'line-chart')
                .attr('width', WIDTH)
                .attr('height', HEIGHT);

        var chartTitle = d3.select(dom)
                .append('div')
                .attr('class', 'chart-title')
                .style('width', CHART_AREA_DIMS.width + "px")
                .style('padding-left', MARGIN.left + "px")
                .text(CHART_TITLE);

        var chartArea = svg.append('g')
                .attr('width', CHART_AREA_DIMS.width)
                .attr('height', CHART_AREA_DIMS.height)
                .attr('transform', "translate(" + MARGIN.left + "," + MARGIN.top + ")");

        var yAxis = d3.svg.axis()
                .scale(configs.yScale)
                .orient('left')
                .innerTickSize(-CHART_AREA_DIMS.width)
                .outerTickSize(5);

        chartArea.append('g')
                .attr('class', 'axis axis-y')
                .call(yAxis);

        var xAxis = d3.svg.axis()
                .scale(configs.xScale)
                .orient('bottom')
                .innerTickSize(-CHART_AREA_DIMS.height)
                .outerTickSize(5);

        chartArea.append('g')
                .attr('class', 'axis axis-x')
                .attr('transform', "translate(0, " + CHART_AREA_DIMS.height + ")")
                .call(xAxis);

        var line = chartArea.append('g')
                .attr('class', 'line')
                .append('path')
                .data([data])
                .attr('d', configs.line)
                .attr('stroke', 'rgb(222, 64, 1)');

        var circle = chartArea.append('circle')
                .attr('r', 1.5)
                .attr('fill', 'red')
                .attr('opacity', 0);

        var voronoi = d3.geom.voronoi()
                .x(function (d) {
                    return configs.xScale(d.year);
                }).y(function (d) {
                    return configs.yScale(d.value);
                }).clipExtent([
                    [0, 0],
                    [CHART_AREA_DIMS.width, CHART_AREA_DIMS.height]
                ]);
        var voronoiGroup = chartArea.append('g')
                .attr('class', 'voronoi');

        var voronoiPath = voronoiGroup.selectAll('path')
                .data(voronoi(data))
                .enter()
                .append('path')
                .attr('d', polygon)
                .datum(function(d) {
                    return d.point;
                }).on('mouseenter', function(d) {
                    // print out the data point internal data
                    d3.select(document.getElementById('focused-data-point')).text("Current data point: " + JSON.stringify(d));

                    // highlight hovered polygon
                    d3.select(this)
                            .style('fill', 'rgb(0, 228, 255)')
                            .style('opacity', 0.3);

                    // highlight current data point
                    circle.attr('opacity', 1)
                            .attr('cx', configs.xScale(d.year))
                            .attr('cy', configs.yScale(d.value));
                }).on('mouseout', function() {
                    d3.select(this)
                            .style('fill', 'none')
                            .style('opacity', 1);
                });

        function polygon(d) {
            return "M" + d.join("L") + "Z";
        }
    }
</script>